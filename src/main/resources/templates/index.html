<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <link rel="shortcut icon" href="#"/>
    <title>2.3随便写的标题</title>

    <!--weiUI CSS-->
    <link th:href="@{/css/weui.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/jquery-weui.min.css}" rel="stylesheet" type="text/css"/>


</head>
<body ontouchstart style="position: fixed;top: 0;left: 0;width: 100%;height: 100% ">

<div>
    <a id="mark" href="javascript:" style="font-size: 90px" class="weui-btn_cell weui-btn_cell-default"
       onclick="markTodo('eat')">MARK</a>
</div>

<div class="weui-tab__panel">
    <div class="weui-tab__content" style="display: block;">
        <div id="form">
            <div class="weui-cells__title" id="locationText"></div>
        </div>
    </div>
</div>

</body>
<!--jquery-->
<script type="text/javascript" th:src="@{/js/jquery-3.4.1.min.js}"></script>
<!--weixin SDK-->
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js" charset="utf-8"></script>
<!--weixinUI JS-->
<script type="text/javascript" th:src="@{/js/weui.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery-weui.min.js}"></script>

<script type="text/javascript" th:inline="javascript">

    $(function () {
        init();
    });

    //初始化配置
    function init() {
        var signature = [[${signature}]];
        var appid = [[${appid}]];
        var timestamp = [[${timestamp}]];
        var noncestr = [[${noncestr}]];
        //微信配置
        wx.config({
            debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
            appId: appid, // 必填，公众号的唯一标识
            timestamp: timestamp, // 必填，生成签名的时间戳
            nonceStr: noncestr, // 必填，生成签名的随机串
            signature: signature,// 必填，签名
            jsApiList: ['getLocation', 'openLocation'] // 必填，需要使用的JS接口列表
        });
    }

    function markTodo(actionType) {
        //获取x地理位置
        wx.ready(function () {
            alert("验证成功！！开始获取地理位置！");
            wx.getLocation({
                type: 'wgs84', // 默认为wgs84的gps坐标，如果要返回直接给openLocation用的火星坐标，可传入'gcj02'
                success: function (res) {
                    alert("获取的位置为>:" + JSON.stringify(res));
                    transLocationMsg(res,actionType);
                }
            });
        });
    }

    function transLocationMsg(msg,actionType) {
        $.ajax({
            url: '/wx/mark',
            method: 'get',
            async: false,
            dataType:"json",
            data: {
                "latitude": msg.latitude,
                "longitude": msg.longitude,
                "speed": msg.speed,
                "actionType":actionType
            },
            success: function (res) {

                var text = $("#locationText");

                text.empty();

                if(res.statusCode === 500){
                    text.append("<b>响应结果:" + JSON.stringify(res.statusDes) + "</b>");
                }

                else if(res.statusCode === 200){
                    text.append("<b>定位位置为:" + JSON.stringify(res.resResult) + "</b>");
                }
            },
            error: function (e) {
                alert(JSON.stringify(e));
            }
        })
    }
</script>
</html>